---
title: "FIDE Chess Player Ratings"
output: html_document
date: "2025-09-11"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
theme_set(theme_light())
```

Primary Questions:
- What drives rating performance across different player segments?
- How does chess talent distribution vary globally and demographically?
- Can we identify patterns in player development and career trajectories?
- What factors predict high-performance outliers?

Secondary Investigations:
- Rating inflation/deflation trends over time
- Federation-level competitive strength analysis
- Gender participation and performance gaps
- Title progression pathways and bottlenecks
- Age-related performance curve


```{r}
library(tidyverse)

august_ratings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-23/fide_ratings_august.csv') %>%
  distinct(id, .keep_all = TRUE) %>%
  mutate(month = "August")

september_ratings <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2025/2025-09-23/fide_ratings_september.csv') %>%
  distinct(id, .keep_all = TRUE) %>%
  mutate(month = "September")

test_data <- september_ratings %>% 
  select(!rating)

head(august_ratings)
head(test_data)
```

Performances regarding the sex, title, and federation of the players (simply "player segmentation")

```{r}
august_ratings %>%
  group_by(sex) %>%
  summarise(
    avg_rating = mean(rating, na.rm = TRUE),
    total_players = n()
  )

august_ratings %>%
  group_by(title) %>%
  summarise(
    avg_rating = mean(rating, na.rm = TRUE),
    total_players = n()
  ) %>%
  arrange(desc(avg_rating))

august_ratings %>%
  group_by(fed) %>%
  summarise(
    avg_rating = mean(rating, na.rm = TRUE),
    total_players = n()
  ) %>%
  filter(total_players >= 500) %>%
  arrange(desc(avg_rating))

current_year <- as.numeric(format(Sys.Date(), "%Y"))

august_ratings %>%
  filter(!is.na(bday)) %>%
  mutate(age = current_year - bday) %>%
  group_by(age) %>%
  summarise(
    avg_rating = mean(rating, na.rm = TRUE),
    total_players = n()
  ) %>%
  filter(total_players >= 100) %>%
  arrange(age)
```

Age-related performance curve

```{r}
august_ratings %>%
  filter(!is.na(bday)) %>%
  mutate(age = current_year - bday) %>%
  group_by(age) %>%
  summarise(
    avg_rating = mean(rating, na.rm = TRUE),
    total_players = n()
  ) %>%
  filter(total_players >= 100) %>%
  ggplot(aes(x = age, y = avg_rating)) +
  geom_line(color = "steelblue", size = 1) +
  geom_point(color = "steelblue", size = 2) +
  labs(
    title = "Average FIDE Rating by Age",
    x = "Age (Years)",
    y = "Average Rating"
  )
```

Prediction and Visualizations regarding our model

```{r}
model <- lm(rating ~ sex + title + k, data = august_ratings)

clean_september_ratings <- september_ratings %>%
  filter(!is.na(sex) & !is.na(title) & !is.na(k) & !is.na(bday))

predicted_ratings <- predict(model, newdata = clean_september_ratings)

clean_september_ratings$predicted_sept_rating <- predicted_ratings

# Calculate the error on this single, consistent data frame.
final_results <- clean_september_ratings %>%
  rename(actual_sept_rating = rating) %>%
  mutate(prediction_error = predicted_sept_rating - actual_sept_rating)

summary(final_results$prediction_error)

ggplot(final_results, aes(x = actual_sept_rating, y = predicted_sept_rating)) +
  geom_point(alpha = 0.5) +
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed", size = 1) +
  labs(
    title = "Actual vs. Predicted September FIDE Ratings",
    subtitle = "A strong alignment with the dashed line indicates good model performance",
    x = "Actual September Rating",
    y = "Predicted September Rating"
  )

ggplot(final_results, aes(x = prediction_error)) +
  geom_histogram(binwidth = 10, fill = "dodgerblue", color = "white") +
  geom_vline(aes(xintercept = mean(prediction_error)), color = "red", linetype = "dashed", size = 1) +
  labs(
    title = "Distribution of Model Prediction Errors",
    subtitle = "The dashed red line indicates the mean error, which is close to zero.",
    x = "Prediction Error (Predicted Rating - Actual Rating)",
    y = "Number of Players")

ggsave("prediction_errors.png", width = 8, height = 6, dpi = 300)


summary(september_ratings$rating)
summary(final_results$predicted_sept_rating)

final_results %>% 
  select(predicted_sept_rating, actual_sept_rating, prediction_error)
```
